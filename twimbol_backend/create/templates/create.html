{% extends 'base.html' %} 
{% block title %}Twimbol{% endblock %} 
{% load static %}
{% block style %}<link rel="stylesheet" href="{%static 'css/creator.css' %}">{% endblock %}
{% block content %}

    <menu type="toolbar">
    <li>
        <a href="{% url 'dashboard' %}"
        ><button id="dashboard">Dashboard</button></a
        >
    </li>
    <li>
        <a href="{% url 'post' %}"
        ><button id="post">Add Post</button></a
        >
    </li>
    <li>
        <a href="{% url 'video' %}"
        ><button id="video">Add Video</button></a
        >
    </li>
    <li>
        <a href="{% url 'reel' %}"
        ><button id="reel">Add Reel</button></a
        >
    </li>
    <li>
        <a href="{% url 'manage-contents' %}"
        ><button id="manage-conents">Manage Contents</button></a
        >
    </li>
    <li>
        <a href="{% url 'settings' %}"
        ><button id="settings">Settings</button></a
        >
    </li>
    </menu> 


    <h1>{{create_action}}</h1>

    {% if post.post_type == 'post' %}{% endif %}


    {% if create_action == 'dashboard' %}

    {% if upload_message %} <p>{{upload_message}}</p> {%endif%}


    {% for post in posts %}
    {% if post.post_type == 'post' %}

    {% if post.post_banner %}
    <a href="{% url 'post_create_edit' %}">
    <div class="post_creator_dashboard">
        <img src="{{ post.post_banner.url }}" alt="">
        <p>{{post.post_title|slice:"30"}}</p>
        
    </div></a>

    {% endif %}
    
    {% endif %}
    

    {%endfor%}


    {% endif %}







    {% if create_action == 'video' %}
    <a href="{% url 'video_link' %}"><button>Upload from link</button></a>
    <a href="{% url 'video_upload' %}"><button>Upload from device</button></a>
    {% endif %}



    {% if user.is_authenticated == False %}
    You're not logged in
    <br><a href="{% url 'login' %}">Login</a>

    {% endif %}


    {% if form %}
    <form action="" method="post" id="form-controls"  enctype="multipart/form-data">
        {% csrf_token %} 
        
        {{form.as_p}}
        
        <script>function getYouTubeVideoID(url) {        const regex = /(?:youtube\.com\/(?:watch\?v=|embed\/|v\/|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;        const match = url.match(regex);        return match ? match[1] : null; } document.getElementById("form-controls").addEventListener("submit", function (e) {        const input = document.getElementById("yt-form-control-video-id");        const videoId = getYouTubeVideoID(input.value);   if (videoId) {            input.value = videoId;        } else {            e.preventDefault();            alert("Please enter a valid YouTube URL.");        }    });</script>

        

        <button type="submit">Save</button>
    </form>

    {% endif %} 


    {% if video_upload %}

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="text" name="title" placeholder="Title"><br>
        <input type="text" name="description" placeholder="Description"><br>
        <input type="file" name="video" id="videoFile" accept="video/*"><br>
        <button type="submit" id="video_upload_btn" disabled>Upload</button>
      </form>
      
      
      <video id="submitted_video" style="display: none;"></video>
      
      <script>
      let objectUrl = null;
      
      document.getElementById("videoFile").addEventListener("change", function(event) {
          const file = event.target.files[0];
          if (file) {
              // Revoke old object URL if it exists
              if (objectUrl) {
                  URL.revokeObjectURL(objectUrl);
              }
      
              objectUrl = URL.createObjectURL(file);
              const video = document.getElementById("submitted_video");
              video.src = objectUrl;
      
              video.addEventListener("canplaythrough", function handleCanPlay() {
                  const duration = video.duration;
                  
                  const uploadButton = document.getElementById("video_upload_btn");

                  if (duration){
                    if (duration > 0 && duration < 60) {
                        uploadButton.removeAttribute("disabled");
                        } else {
                            uploadButton.setAttribute("disabled", "true");
                            alert("Can't upload videos longer than 60 seconds");
                    }
                }

      
                  URL.revokeObjectURL(objectUrl); // Clean up memory
                  video.removeEventListener("canplaythrough", handleCanPlay); // Prevent duplicate triggers
              });
      
              video.load(); // Force the video to load metadata
          }
      });
      </script>
      

      
    {% endif %}



    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    {% if reel_upload %}

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="text" name="title" placeholder="Title"><br>
        <input type="text" name="description" placeholder="Description"><br>
        <input type="file" name="video" id="videoFile" accept="video/*"><br>
        <button type="submit" id="video_upload_btn" disabled>Upload</button>
      </form>
      <p class="upload_warning" id="upload_warning"></p>
      
      
      <video id="submitted_video" style="display: none;"></video>
      
      <script>
      let objectUrl_reel = null;
      
      document.getElementById("videoFile").addEventListener("change", function(event) {
          const file = event.target.files[0];
          if (file) {
              // Revoke old object URL if it exists
              if (objectUrl_reel) {
                  URL.revokeObjectURL(objectUrl_reel);
              }
      
              objectUrl_reel = URL.createObjectURL(file);
              const video = document.getElementById("submitted_video");
              video.src = objectUrl_reel;
      
              video.addEventListener("canplaythrough", function handleCanPlay() {
                  const duration = video.duration;
                  
                  const uploadButton = document.getElementById("video_upload_btn");

                  if (duration){
                    if (duration > 0 && duration < 30) {
                        uploadButton.removeAttribute("disabled");
                        document.getElementById('upload_warning').innerText = ("");
                        document.getElementById('upload_warning').style.color = 'green';
                        } else {
                            uploadButton.setAttribute("disabled", "true");
                            document.getElementById('upload_warning').innerText = ("Can't upload reels longer than 30 seconds");
                            document.getElementById('upload_warning').style.color = 'red';
                    }
                }

      
                  URL.revokeObjectURL(objectUrl_reel); // Clean up memory
                  video.removeEventListener("canplaythrough", handleCanPlay); // Prevent duplicate triggers
              });
      
              video.load(); // Force the video to load metadata
          }
      });
      </script>
      

      
    {% endif %}









{% endblock %} 



{% block script %}
<!-- <script src="create.js"></script> -->

<script>
  document.getElementById("{{create_action}}").setAttribute("disabled", "true");
</script>
{% endblock %}
